---
title: Code Generation
description: openapi-typescript type generation, openapi-fetch typed client, and Zod OpenAPI schema-first document generation
tags: [openapi-typescript, openapi-fetch, zod-openapi, codegen, types, client]
---

# Code Generation

## openapi-typescript

Generates zero-runtime TypeScript types from OpenAPI 3.0/3.1 schemas.

### Installation

```bash
npm i -D openapi-typescript typescript
```

### Generate Types

From a local file:

```bash
npx openapi-typescript ./path/to/api.yaml -o ./src/lib/api/v1.d.ts
```

From a remote URL:

```bash
npx openapi-typescript https://api.example.com/openapi.json -o ./src/lib/api/v1.d.ts
```

### Generated Type Structure

The output creates a `paths` interface keyed by path and method:

```ts
import type { paths } from './api/v1';

type ListUsersResponse =
  paths['/users']['get']['responses']['200']['content']['application/json'];

type CreateUserBody =
  paths['/users']['post']['requestBody']['content']['application/json'];

type GetUserParams = paths['/users/{userId}']['get']['parameters']['path'];
```

### Script Integration

Add to `package.json` for consistent regeneration:

```json
{
  "scripts": {
    "generate:api": "openapi-typescript ./openapi.yaml -o ./src/lib/api/schema.d.ts"
  }
}
```

## openapi-fetch

Type-safe HTTP client that uses types generated by `openapi-typescript`. Zero runtime overhead beyond native `fetch`.

### Installation

```bash
npm i openapi-fetch
npm i -D openapi-typescript typescript
```

### Client Setup

```ts
import createClient from 'openapi-fetch';
import type { paths } from './api/v1';

const client = createClient<paths>({ baseUrl: 'https://api.example.com/v1/' });
```

### GET Requests

```ts
const { data, error } = await client.GET('/users/{userId}', {
  params: {
    path: { userId: '123' },
  },
});

if (error) {
  console.error(error.code, error.message);
  return;
}

console.log(data.name);
```

### GET with Query Parameters

```ts
const { data, error } = await client.GET('/users', {
  params: {
    query: { page: 1, limit: 20, role: 'admin' },
  },
});
```

### POST Requests

```ts
const { data, error } = await client.POST('/users', {
  body: {
    name: 'Jane Doe',
    email: 'jane@example.com',
    role: 'member',
  },
});
```

### PUT Requests

```ts
const { data, error } = await client.PUT('/users/{userId}', {
  params: {
    path: { userId: '123' },
  },
  body: {
    name: 'Jane Smith',
    email: 'jane.smith@example.com',
  },
});
```

### DELETE Requests

```ts
const { data, error } = await client.DELETE('/users/{userId}', {
  params: {
    path: { userId: '123' },
  },
});
```

### Middleware

Add authentication or logging with middleware:

```ts
const client = createClient<paths>({
  baseUrl: 'https://api.example.com/v1/',
});

client.use({
  async onRequest({ request }) {
    const token = getAccessToken();
    request.headers.set('Authorization', `Bearer ${token}`);
    return request;
  },
  async onResponse({ response }) {
    if (response.status === 401) {
      await refreshToken();
    }
    return response;
  },
});
```

### Error Handling Pattern

The `data` and `error` fields are mutually exclusive based on status code:

```ts
const { data, error, response } = await client.GET('/users/{userId}', {
  params: { path: { userId: '123' } },
});

if (error) {
  switch (response.status) {
    case 404:
      console.error('User not found');
      break;
    case 422:
      console.error('Validation errors:', error.errors);
      break;
    default:
      console.error('Unexpected error:', error.message);
  }
  return;
}

console.log(data.name);
```

## Zod OpenAPI

Generate OpenAPI 3.1 documents from Zod schemas. Keeps validation and documentation in sync.

### Installation

```bash
npm i zod-openapi zod
```

### Define Schemas with Metadata

Use `.meta()` to attach OpenAPI metadata to Zod schemas:

```ts
import * as z from 'zod';
import { createDocument } from 'zod-openapi';

const UserId = z.string().uuid().meta({
  description: 'Unique user identifier',
  example: '550e8400-e29b-41d4-a716-446655440000',
  id: 'UserId',
});

const UserName = z.string().min(1).max(255).meta({
  description: 'User display name',
  example: 'Jane Doe',
});

const UserEmail = z.string().email().meta({
  description: 'User email address',
  example: 'jane@example.com',
});

const UserRole = z.enum(['admin', 'member', 'viewer']).meta({
  description: 'User role within the organization',
  id: 'UserRole',
});
```

The `id` field in `.meta()` auto-registers the schema as a reusable component in the output document.

### Create a Document

```ts
const document = createDocument({
  openapi: '3.1.0',
  info: {
    title: 'Users API',
    version: '1.0.0',
  },
  paths: {
    '/users/{userId}': {
      get: {
        operationId: 'getUser',
        requestParams: {
          path: z.object({ userId: UserId }),
        },
        responses: {
          '200': {
            description: 'User details',
            content: {
              'application/json': {
                schema: z.object({
                  id: UserId,
                  name: UserName,
                  email: UserEmail,
                  role: UserRole,
                }),
              },
            },
          },
          '404': {
            description: 'User not found',
            content: {
              'application/json': {
                schema: z.object({
                  code: z.string(),
                  message: z.string(),
                }),
              },
            },
          },
        },
      },
    },
  },
});
```

### Generate Standalone Schemas

Use `createSchema` when you need just the schema and components without a full document:

```ts
import { createSchema } from 'zod-openapi';

const User = z.object({
  id: UserId,
  name: UserName,
  email: UserEmail,
  role: UserRole,
});

const { schema, components } = createSchema(User);
```

The `schema` output is a valid OpenAPI Schema Object. The `components` object contains any schemas registered via `id` in `.meta()`.

### Request Body with Zod

```ts
const CreateUserRequest = z.object({
  name: UserName,
  email: UserEmail,
  role: UserRole.optional().default('member'),
});

const document = createDocument({
  openapi: '3.1.0',
  info: { title: 'Users API', version: '1.0.0' },
  paths: {
    '/users': {
      post: {
        operationId: 'createUser',
        requestBody: {
          required: true,
          content: {
            'application/json': { schema: CreateUserRequest },
          },
        },
        responses: {
          '201': {
            description: 'User created',
            content: {
              'application/json': {
                schema: z.object({
                  id: UserId,
                  name: UserName,
                  email: UserEmail,
                  role: UserRole,
                }),
              },
            },
          },
        },
      },
    },
  },
});
```

### Writing the Document to YAML

```ts
import { stringify } from 'yaml';

const yamlOutput = stringify(document);
```

Output the YAML to a file for use with other OpenAPI tools (documentation generators, API gateways, client generators).
