---
title: Configuration
description: Vite plugin setup, defineConfig options, package.json exports, and build output configuration
tags:
  [
    vite,
    tanstackViteConfig,
    defineConfig,
    mergeConfig,
    esm,
    cjs,
    exports,
    build,
  ]
---

# Configuration

## Installation

```bash
pnpm add -D @tanstack/vite-config vite publint
```

## Basic Vite Configuration

The `tanstackViteConfig` function provides an opinionated Vite build setup for dual ESM/CJS publishing. Merge it with your own Vite config using `mergeConfig`:

```ts
import { defineConfig, mergeConfig } from 'vite';
import { tanstackViteConfig } from '@tanstack/vite-config';

const config = defineConfig({
  // Framework plugins, vitest config, etc.
});

export default mergeConfig(
  config,
  tanstackViteConfig({
    entry: './src/index.ts',
    srcDir: './src',
  }),
);
```

## Configuration Options

The `tanstackViteConfig` function accepts an options object with these properties:

```ts
import { type Options } from '@tanstack/vite-config';

const options: Options = {
  // Required: entry file or array of entry files
  entry: './src/index.ts',
  // Or multiple entries:
  // entry: ['./src/index.ts', './src/utils.ts'],

  // Required: source directory for declaration file generation
  srcDir: './src',

  // Output directory (default: 'dist')
  outDir: './dist',

  // Generate CJS output alongside ESM (default: true)
  cjs: true,

  // Patterns to exclude from type generation
  exclude: ['./src/**/*.test.ts', './src/__mocks__'],

  // Path to custom tsconfig
  tsconfigPath: './tsconfig.build.json',

  // Additional dependencies to externalize (auto-detected from package.json)
  externalDeps: [/^@internal\//],

  // Dependencies to bundle instead of externalize
  bundledDeps: ['tiny-invariant'],

  // Hook to transform declaration file content before writing
  beforeWriteDeclarationFile: (filePath, content) => {
    return `// Generated by TanStack Config\n${content}`;
  },
};
```

## Package.json Exports Configuration

The build output requires a properly configured `exports` field in `package.json`:

```json
{
  "name": "my-library",
  "type": "module",
  "exports": {
    ".": {
      "import": {
        "types": "./dist/esm/index.d.ts",
        "default": "./dist/esm/index.js"
      },
      "require": {
        "types": "./dist/cjs/index.d.cts",
        "default": "./dist/cjs/index.cjs"
      }
    },
    "./package.json": "./package.json"
  },
  "scripts": {
    "build": "vite build && publint --strict"
  }
}
```

Key requirements for `package.json`:

- `"type": "module"` must be set for ESM-first output
- The `exports` field defines both `import` (ESM) and `require` (CJS) conditions
- Each condition includes `types` first, then `default` for proper TypeScript resolution
- Export `./package.json` for tools that need to read package metadata

## Multiple Entry Points

For libraries with multiple entry points, use an array for the `entry` option and add corresponding `exports`:

```ts
export default mergeConfig(
  config,
  tanstackViteConfig({
    entry: ['./src/index.ts', './src/utils.ts'],
    srcDir: './src',
  }),
);
```

```json
{
  "exports": {
    ".": {
      "import": {
        "types": "./dist/esm/index.d.ts",
        "default": "./dist/esm/index.js"
      },
      "require": {
        "types": "./dist/cjs/index.d.cts",
        "default": "./dist/cjs/index.cjs"
      }
    },
    "./utils": {
      "import": {
        "types": "./dist/esm/utils.d.ts",
        "default": "./dist/esm/utils.js"
      },
      "require": {
        "types": "./dist/cjs/utils.d.cts",
        "default": "./dist/cjs/utils.cjs"
      }
    },
    "./package.json": "./package.json"
  }
}
```

## ESM-Only Output

To skip CJS generation, set `cjs: false`:

```ts
export default mergeConfig(
  config,
  tanstackViteConfig({
    entry: './src/index.ts',
    srcDir: './src',
    cjs: false,
  }),
);
```

When distributing ESM-only, simplify the `exports` field:

```json
{
  "type": "module",
  "exports": {
    ".": {
      "types": "./dist/esm/index.d.ts",
      "default": "./dist/esm/index.js"
    },
    "./package.json": "./package.json"
  }
}
```

## Dependency Handling

Dependencies listed in `package.json` (`dependencies`, `peerDependencies`) are automatically externalized. Use `externalDeps` to add patterns beyond what is auto-detected:

```ts
tanstackViteConfig({
  entry: './src/index.ts',
  srcDir: './src',
  externalDeps: [/^@internal\//, 'shared-utils'],
});
```

To force-bundle a dependency instead of externalizing it:

```ts
tanstackViteConfig({
  entry: './src/index.ts',
  srcDir: './src',
  bundledDeps: ['tiny-invariant', 'ts-invariant'],
});
```

## Build Validation

Run `publint --strict` after the build to validate the package output:

```bash
pnpm build
# Runs: vite build && publint --strict
```

publint checks that the `exports` field matches actual build output, verifies file extensions are correct for ESM/CJS, and catches common packaging mistakes.
